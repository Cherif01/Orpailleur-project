<div class="main-container">
  <div class="pd-ltr-20 xs-pd-20-10">
    <div class="min-height-200px">
      <div class="page-header">
        <div class="row">
          <div class="col-12 col-md-4 col-sm-12">
            <div class="title">
              <h4 class="text-capitalize fs-3">{{title}}</h4>
            </div>
            <nav aria-label="breadcrumb" role="navigation">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{title}}</li>
              </ol>
            </nav>
          </div>
          <div class="text-right d-flex justify-content-between align-items-center">
            <div class="col-reply">
              <button (click)="this.location.back()" mat-icon-button color="warn"><mat-icon
                  class="mat-24">reply</mat-icon>
              </button>
            </div>
            <div class="col-btn">
              <button class="mx-2 fw-bold" mat-flat-button color="accent" routerLink="/operation/facture-fournisseur">
                <span class="micon dw dw-list"></span><span class="mtext mx-2"> Liste</span>
              </button>
              <button class="mx-2 fw-bold" mat-flat-button color="primary" routerLink="/operation/add-purchase">
                <span class="micon dw dw-up-arrow"></span><span class="mtext mx-2"> Autres</span>
              </button>
            </div>
          </div>
        </div>
      </div>


      <!-- CONFIG -->

      <div class="d-flex justify-content-between flex-wrap">
        <div class="col">
          <div class="m-2">
            <h2 class="text-center fw-bold h5">Facture par fixing...</h2>
            <form class="" [formGroup]="Fixing" (ngSubmit)="fixingPOST(Fixing)">
              <div class="d-flex justify-content-between flex-wrap flex-row align-items-center mb-2">
                <div class="col-12">
                  <!-- FOURNISSEUR -->
                  <mat-form-field appearance="outline" class="w-100 mb-2">
                    <mat-label>--- Liste Fixing ---</mat-label>
                    <mat-select formControlName="id" required (selectionChange)="infosFixing($event.value)">
                      <mat-option>--</mat-option>
                      <mat-option *ngFor="let data of ListFixing" [value]="data.id">
                        Fixing : $<span class="text-primary fw-bold">{{ data.fixing_bourse | number }} > </span>
                        {{data.fournisseur.prenom + " " + data.fournisseur.nom }} >
                        <strong>Poids: {{ data.poids_fixe | number }} g</strong>
                      </mat-option>
                    </mat-select>
                    <mat-hint>Liste des fixings</mat-hint>
                  </mat-form-field>
                </div>

                <div class="col-12">
                  <button type="submit" mat-raised-button class="w-100" color="primary"
                    [disabled]="!Fixing.valid"><span class="mx-2">
                      Afficher </span>
                    <mat-icon>add</mat-icon>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- CONFIG -->

      <div class="d-flex align-items-center justify-content-between" *ngIf="fixingClick == true">
        <div class="col-4">
          <button (click)="this.location.back()" mat-icon-button color="warn"><mat-icon class="mat-24">reply</mat-icon>
          </button>
        </div>
        <div align="end" class="col">
          <button mat-raised-button color="primary" (click)="imprimerDiv()">Imprimer</button>
        </div>
        <mat-divider></mat-divider>
      </div>


      <!-- Export Datatable start -->
      <mat-card *ngIf="fixingClick == true" class="m-2">
        <!-- Facture entete -->
        <div class="container-fluid" id="facture" #divToPrint>
          <!-- table LIST -->
          <div class="col">
            <div class="entete">
              <div class="d-flex justify-content-between flex-wrap m-0 p-0 align-items-center">
                <div class="col-2 text-start">
                  <!-- logo -->
                  <div class="img-responsive">
                    <img src="/assets/logo/coins.png" class="img-responsive w-100" alt="">
                  </div>
                </div>
                <div class="col offset-1  text-center">
                  <h2 class="m-0 p-0">LIMANAYA BUSINESS</h2>
                  <span class="small">Achateur et vendeur d'or en gros et details</span> <br>
                  <span class="small">sis &#224; Mafanco Carrefour, centre commercial Bayo et frères au 2e
                    étage</span>
                  <br>
                  <span class="fw-bold">Adresse : </span>
                  <span class="text-primary"> 628-978-467 / 624-044-759 </span>
                </div>
                <div class="col-2 offset-1 text-end">
                  <!-- logo -->
                  <div class="img-responsive">
                    <img src="/assets/logo/logo.png" class="img-responsive w-100" alt="">
                  </div>
                </div>
              </div>
            </div>
            <hr>
            <div class="d-flex justify-content-between flex-wrap">
              <div class="col-5 mb-3">
                <div class="border border-2 border-dark rounded-3 p-2">
                  <div class="border border-1 border-secondary p-3 text-center rounded-3 m-1">
                    <h3>Complement</h3>
                  </div>
                  <div class="p-2 fs-5">
                    <th>Fixing : <span class="mx-3 small">$ {{ infosFix.fixing_bourse | number }}</span></th> <br>
                    <!-- <th>Poids : <span class="mx-3 small"> {{ infosFix.poids_fixe | number }} g</span></th> <br> -->
                    <th>Solde : <span class="mx-3 small">$ {{ 0 | number }}</span></th>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="table-responsive m-0" id="bgTable">
            <h2 class="text-dark text-center fw-bold display-2">Facture N<sup>o</sup> : <span class="text-dark">#000-000-000{{ infosFix.id }}</span></h2>
            <h4 class="text-dark text-end mx-4">Date : {{ 0 | date: 'dd/MM/YYYY' }}</h4>
            <table class="table printTable">
              <thead class="text-center">
                <th>NB Barres</th>
                <th>Poids</th>
                <th>Carrat</th>
                <th>Densite</th>
                <th>P.Uni</th>
                <th>Montant</th>
              </thead>
              <tbody class="text-center" *ngIf="_TYPE_ == false">
                <tr>
                  <td colspan="6" class="fs-5"><span class="fw-bold">{{ fournisseurName }}</span></td>
                </tr>
                <tr *ngFor="let data of TabItemsFix; let i = index">
                  <td>{{ i+1 }}</td>
                  <td>{{ data.achat_items.poids_achat | number }}</td>
                  <td>{{ data.achat_items.carrat_achat | number }}</td>
                  <td>{{ 22 }}</td>
                  <td>{{ ((infosFix.fixing_bourse/34) - infosFix.discompte).toString().substring(0, 5) | number }} </td>
                  <td>{{ calculPrice(((infosFix.fixing_bourse/34) - infosFix.discompte).toString().substring(0, 5),
                    data.achat_items.poids_achat, data.achat_items.carrat_achat).toLocaleString('fr-FR', {useGrouping: true}) }}</td>
                </tr>
              </tbody>
              <tbody class="text-center" *ngIf="_TYPE_ == true">
                <tr>
                  <td colspan="6" class="fs-5"><span class="fw-bold">{{ fournisseurName }}</span></td>
                </tr>
                <tr *ngFor="let data of TabItemsFix; let i = index; ">
                  <td>{{ i+1 }}</td>
                  <td>{{ data.poids_achat | number }}</td>
                  <td>{{ data.carrat_achat | number }}</td>
                  <td>{{ 22 }}</td>
                  <td>{{ ((infosFix.fixing_bourse/34) - infosFix.discompte).toString().substring(0, 5) | number }} </td>
                  <td>{{ calculPrice(((infosFix.fixing_bourse/34) - infosFix.discompte).toString().substring(0, 5),
                    data.poids_achat, data.carrat_achat).toLocaleString('fr-FR', {useGrouping: true}) }}</td>
                </tr>
              </tbody>
              <tfoot class="border-0 fs-6" style="font-family: arial">
                <tr class="border-0">
                  <th class="text-center text-dark text-uppercase">Total </th>
                  <th class="text-center text-primary">{{ poidsTotal.toLocaleString('fr-FR', {useGrouping: true}) }} g</th>
                  <th class="text-center text-primary">{{ (carratMoyen / poidsTotal) | number }}</th>
                  <th class="text-center text-primary"> --- </th>
                  <th class="text-center text-primary"> --- </th>
                  <th class="text-center text-primary"> {{ Total.toLocaleString('fr-FR', {useGrouping: true}) }} </th>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </mat-card>
      <!-- Export Datatable End -->
    </div>
  </div>
