<div class="main-container">
  <div class="pd-ltr-20 xs-pd-20-10">
    <div class="min-height-200px">
      <div class="page-header">
        <div class="row">
          <div class="col-12 col-md-4 col-sm-12">
            <div class="title">
              <h4 class="text-capitalize fs-3">{{title}}</h4>
            </div>
            <nav aria-label="breadcrumb" role="navigation">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{title}}</li>
              </ol>
            </nav>
          </div>
          <div class="text-right d-flex justify-content-between align-items-center">
            <div class="col-reply">
              <button (click)="this.location.back()" mat-icon-button color="warn"><mat-icon
                  class="mat-24">reply</mat-icon>
              </button>
            </div>
            <div class="col-btn">
              <button class="mx-2 fw-bold" mat-flat-button color="primary" routerLink="/operation/create-facture/">
                <span class="micon dw dw-list"></span><span class="mtext mx-2"> Facture</span>
              </button>
              <button class="mx-2 fw-bold" mat-flat-button color="primary" routerLink="/operation/add-purchase">
                <span class="micon dw dw-up-arrow"></span><span class="mtext mx-2"> Autres</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Export Datatable start -->
      <div class="...-box mb-30">
        <!-- END SERVICE FILTER -->
        <div class="d-flex justify-content-between flex-wrap">
          <div class="col-12 col-md-4 col-lg-4">
            <div class="responsive">
              <div class="card mb-2 shadow-lg border-0">
                <div class="card-header text-center">
                  <h4 class="fw-bold">{{ Name_fournisseur }}</h4>
                  <span>{{ Adresse_fournisseur }}</span>
                </div>
                <div class="card-body text-center">
                  <div class="mt-2" *ngIf="poids_fixer != poidsAttribuer">
                    <form [formGroup]="UpdateFixing" (ngSubmit)="UFix(UpdateFixing)">
                      <div class="col">
                        <mat-form-field class="w-100">
                          <mat-label>Nouveau poids</mat-label>
                          <input matInput type="number" formControlName="poids_fixe" class="w-100" placeholder="Nouveau poids">
                        </mat-form-field>
                      </div>
                      <div class="col text-center">
                        <button type="submit" class="w-100" [disabled]="!UpdateFixing.valid" mat-raised-button
                          color="primary">
                          <span class="dw dw-add"></span> Valider la mise a jour
                        </button>
                      </div>
                    </form>
                  </div>
                  <div class="mt-2" *ngIf="poids_fixer == poidsAttribuer">
                    <form [formGroup]="confirmFixing" (ngSubmit)="ClotureFix(confirmFixing)">
                      <div class="col text-center">
                        <button type="submit" class="w-100" [disabled]="!confirmFixing.valid" mat-raised-button
                          color="accent">
                          <span class="dw dw-add"></span> Cloturer le fixing
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
                <div class="card-footer text-center p-0 m-0">
                  <div class="" *ngIf="poids_fixer != poidsAttribuer">
                    <h3>Fixing : $<span class="text-danger fw-bold p-0"> {{ fixing_bourse | number: '2.2-2' }} </span>
                      <br> Poids actifs : <span class="text-primary fw-bold p-0"> {{ poids_fixer - poidsAttribuer |
                        number }} g</span>
                    </h3>
                  </div>
                  <h4 class="text-dark fw-bold p-0" *ngIf="poids_fixer == poidsAttribuer">En attente de cloture!</h4>
                </div>
              </div>
            </div>
          </div>

          <div class="col mt-0" *ngIf="poids_fixer != poidsAttribuer">
            <mat-card class="mat-elevation-z0 mb-5">
              <mat-card-content>
                <table class="table table-hover">
                  <thead>
                    <th>#Ref</th>
                    <th>Date arrivage</th>
                    <th>Poids Total</th>
                    <th>Carrat Moyen</th>
                    <th class="text-center">Action</th>
                  </thead>
                  <tbody>
                    <tr *ngFor="let x of ListAchatThis">
                      <td>#00{{ x.id }}</td>
                      <td>{{ x.created_at | date: 'dd/MM/YYYY' }}</td>
                      <td>{{ x.poids_total }}</td>
                      <td>{{ x.carrat_moyen }}</td>
                      <td class="text-center">
                        <form>
                          <button (click)="viewDetailAchat(x.slug, x.id)" mat-button color="primary">Selectionner
                            <span class="dw dw-right-arrow"></span></button>
                        </form>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </mat-card-content>
            </mat-card>
          </div>
          <div class="col" *ngIf="poids_fixer == poidsAttribuer">
            <p id="p1">
              <i> <strong>Lorem</strong> ipsum dolor sit amet consectetur adipisicing elit. At officiis ratione animi
                reprehenderit vitae
                itaque suscipit fugit possimus tenetur doloremque. Esse nesciunt accusamus maiores aut. Quisquam
                deleniti
                accusantium veniam minus.
                Lorem ipsum dolor sit amet consectetur adipisicing elit. At officiis ratione animi reprehenderit vitae
                itaque suscipit fugit possimus tenetur doloremque. Esse nesciunt accusamus maiores aut. Quisquam
                deleniti
                accusantium veniam minus.</i> <br> <br>
              <i> <strong>Lorem</strong> ipsum dolor sit amet consectetur adipisicing elit. At officiis ratione animi
                reprehenderit vitae
                itaque suscipit fugit possimus tenetur doloremque. Esse nesciunt accusamus maiores aut. Quisquam
                deleniti
                accusantium veniam minus.
                Lorem ipsum dolor sit amet consectetur adipisicing elit. At officiis ratione animi reprehenderit vitae
                itaque suscipit fugit possimus tenetur doloremque. Esse nesciunt accusamus maiores aut. Quisquam
                deleniti
                accusantium veniam minus.</i> <br>
            </p>
          </div>
        </div>

        <hr>

        <div class="card mb-4 mb-lg-0 shadow-lg mt-3" *ngIf="listItems.length > 0">
          <div class="d-flex justify-content-between flex-wrap">
            <div class="col-12 col-lg-7 p-2">
              <div>
                <div class="d-flex jutify-content-between align-items-center">
                  <div class="col-4">
                    <h2 class="text-secondary small">Barre Achat</h2>
                  </div>
                  <div class="col text-end">
                    <button type="button" class="mx-2 border-primary border" mat-button color="primary"
                      (click)="functionOneByOne()"> <span class="dw dw-check"></span> Par barre</button>
                    |
                    <button type="button" class="mx-2 border-primary border" mat-button color="warn"
                      (click)="functionAllAdd()"> <span class="dw dw-checked"></span> Tout selectionner</button>
                  </div>
                </div>
                <hr>
                <!-- List item -->
                <div class="" id="listItem">
                  <table class="table table-light table-striped table-hover" id="table_shadow">
                    <thead class="text-primary">
                      <th>#</th>
                      <th>Poids</th>
                      <th>Carrat</th>
                      <th>P.Unit</th>
                      <th class="text-center">Action</th>
                    </thead>
                    <tbody>
                      <tr *ngFor="let data of listItems; let i = index">
                        <td>{{ i+1 }}</td>
                        <td>{{ data.poids_achat }}</td>
                        <td>{{ data.carrat_achat }}</td>
                        <td>{{ ((fixing_bourse / 34) - discount).toString().substring(0, 5) }}</td>
                        <td class="text-center">

                          <form [formGroup]="FactureFixing"
                            (ngSubmit)="FactureFixingAdd(FactureFixing, data.id, data.poids)">
                            <button type="submit" class="btn btn-outline-success" *ngIf="allAdd == false" mat-button>
                              <span class="dw dw-shopping-cart-1 mx-2"></span> Ajouter
                            </button>
                          </form>

                          <button type="button" class="btn btn-success" *ngIf="allAdd == true">
                            <span class="dw dw-check"></span>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="col p-3">
              <div class="shadow-lg p-3 m-3" *ngIf="allAdd == true">
                <table class="table table-light table-striped table-hover" id="table_shadow">
                  <tr>
                    <th>Poids Total</th>
                    <th>:</th>
                    <td>{{ infoAchatView.poids_total | number }}</td>
                  </tr>
                  <tr>
                    <th>Carra Moyen</th>
                    <th>:</th>
                    <td>{{ (infoAchatView.carrat_moyen) | number }}</td>
                  </tr>
                </table>
                <form [formGroup]="FactureFixing" (ngSubmit)="FactureFixingAdd(FactureFixing, 0, 0)">
                  <button type="submit" class="btn btn-success w-100" [hidden]="allAdd == false">
                    <span class="dw dw-check"></span> Valider</button>
                </form>
              </div>

              <div class="col" *ngIf="allAdd == false">
                <h2 class="text-secondary text-center">Fixing / Poids direct</h2>
                <div class="m">
                  <div class="card mb-2 shadow-lg border-0">
                    <div class="card-header text-center fw-bold">
                      <h4 class="fw-bold p-0">ACHAT No: <span class="text-danger">#00{{ infoAchatView.id }}</span></h4>
                      <span class="p-1">POIDS : {{ infoAchatView.poids_total }}</span> <br>
                      <span class="p-1">CARRAT : {{ infoAchatView.carrat_moyen }}</span>
                    </div>
                    <div class="card-body text-center">
                      <div class="mt-2">
                        <form [formGroup]="FixingPoids" (ngSubmit)="PFix(FixingPoids)">
                          <div class="col">
                            <mat-form-field class="w-100">
                              <mat-label>Poids</mat-label>
                              <input matInput type="number" min="0" max="{{infoAchatView.poids_total}}" formControlName="poids_select" class="w-100" placeholder="Entrer le poids &#224; prendre (Ex : 1xxx) g">
                            </mat-form-field>
                          </div>
                          <div class="col text-center">
                            <button type="submit" class="w-100" [disabled]="!FixingPoids.valid" mat-raised-button
                              color="primary">
                              <span class="dw dw-add"></span> Valider avec ce poids
                            </button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Export Datatable End -->
      </div>
    </div>
  </div>
</div>
